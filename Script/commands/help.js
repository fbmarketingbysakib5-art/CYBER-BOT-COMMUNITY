module.exports.config = {
    name: "help",
    version: "1.0.2",
    hasPermssion: 0,
    credits: "ğ‚ğ˜ğğ„ğ‘ â˜¢ï¸_ğ–£˜ -ğğğ“ âš ï¸ ğ‘»ğ‘¬ğ‘¨ğ‘´_ â˜¢ï¸",
    description: "FREE SET-UP MESSENGER",
    commandCategory: "system",
    usages: "[Name module]",
    cooldowns: 5,
    envConfig: {
        autoUnsend: true,
        delayUnsend: 20
    }
};

module.exports.languages = {
    "en": {
        "moduleInfo": "â•­â”€â”€â”€â”€â”€â”€â€¢â—ˆâ€¢â”€â”€â”€â”€â”€â”€â•®\n |        Sakib chat bğ—¼t\n |â—ğ—¡ğ—®ğ—ºğ—²: â€¢â€”Â» %1 Â«â€”â€¢\n |â—ğ—¨ğ˜€ğ—®ğ—´ğ—²: %3\n |â—ğ——ğ—²ğ˜€ğ—°ğ—¿ğ—¶pğ˜ğ—¶ğ—¼ğ—»: %2\n |â—ğ—–ğ—®ğ˜ğ—²ğ—´ğ—¼ğ—¿ğ˜†: %4\n |â—ğ—ªğ—®ğ—¶ğ˜ğ—¶ğ—»ğ—´ ğ˜ğ—¶ğ—ºğ—²: %5 seconds(s)\n |â—ğ—£ğ—²ğ—¿ğ—ºğ—¶ğ˜€ğ˜€ğ—¶ğ—¼ğ—»: %6\n |ğ— ğ—¼ğ—±ğ˜‚ğ—¹ğ—² ğ—°ğ—¼ğ—±ğ—² ğ—¯ğ˜†\n |â€¢â€”Â» SAKIB ãƒƒ Â«â€”â€¢\nâ•°â”€â”€â”€â”€â”€â”€â€¢â—ˆâ€¢â”€â”€â”€â”€â”€â”€â•¯",
        "helpList": '[ There are %1 commands on this bot, Use: "%2help nameCommand" to know how to use! ]',
        "user": "User",
        "adminGroup": "Admin group",
        "adminBot": "Admin bot"
    }
};

module.exports.handleEvent = function ({ api, event, getText }) {
    const { commands } = global.client;
    const { threadID, messageID, body } = event;

    if (!body || typeof body === "undefined" || !body.startsWith("help")) return;

    const splitBody = body.trim().split(/\s+/);
    if (splitBody.length === 1 || !commands.has(splitBody[1].toLowerCase())) return;

    const threadSetting = global.data.threadData.get(parseInt(threadID)) || {};
    const command = commands.get(splitBody[1].toLowerCase());
    const prefix = threadSetting.PREFIX || global.config.PREFIX;

    const text = getText(
        "moduleInfo",
        command.config.name,
        command.config.description,
        `${prefix}${command.config.name} ${(command.config.usages) ? command.config.usages : ""}`,
        command.config.commandCategory,
        command.config.cooldowns,
        (command.config.hasPermssion === 0) ? getText("user") : (command.config.hasPermssion === 1) ? getText("adminGroup") : getText("adminBot"),
        command.config.credits
    );

    return api.sendMessage(text, threadID, messageID);
}

module.exports.run = function ({ api, event, args, getText }) {
    const { commands } = global.client;
    const { threadID, messageID } = event;
    const threadSetting = global.data.threadData.get(parseInt(threadID)) || {};
    const prefix = threadSetting.PREFIX || global.config.PREFIX;
    const commandName = (args[0] || "").toLowerCase();
    const command = commands.get(commandName);

    if (commandName === "all") {
        // à¦¸à¦®à¦¸à§à¦¤ à¦•à¦®à¦¾à¦¨à§à¦¡ à¦²à¦¿à¦¸à§à¦Ÿ
        const groups = {};
        for (const cmd of commands.values()) {
            const cat = cmd.config.commandCategory || "Others";
            if (!groups[cat]) groups[cat] = [];
            groups[cat].push(cmd.config.name);
        }

        let msg = "â„ï¸ Command List â„ï¸\n\n";
        for (const cat in groups) {
            msg += `ğŸ“‚ ${cat.toUpperCase()}\n${groups[cat].join(" â€¢ ")}\n\n`;
        }
        msg += `Use ${prefix}help [Name?] to see command details.\nTotal commands: ${commands.size}`;

        return api.sendMessage(msg, threadID, messageID);
    }

    if (!command) {
        return api.sendMessage(`âŒ Command not found! Use ${prefix}help all to see all commands.`, threadID, messageID);
    }

    // à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ à¦•à¦®à¦¾à¦¨à§à¦¡à§‡à¦° à¦¤à¦¥à§à¦¯ à¦¦à§‡à¦–à¦¾à¦¨à§‹
    const text = getText(
        "moduleInfo",
        command.config.name,
        command.config.description,
        `${prefix}${command.config.name} ${(command.config.usages) ? command.config.usages : ""}`,
        command.config.commandCategory,
        command.config.cooldowns,
        (command.config.hasPermssion === 0) ? getText("user") : (command.config.hasPermssion === 1) ? getText("adminGroup") : getText("adminBot"),
        command.config.credits
    );

    return api.sendMessage(text, threadID, messageID);
};
